## XSS原理？防御方法？

XSS Cross Site Scripting 跨站脚本攻击，本质是一种“HTML注入”，用户的数据被当成了HTML代码一部分来执行，从而混淆了原来的语义，产生了新的语义。

如果网站使用了MVC架构，那么XSS发生在View层----在应用拼接变量到HTML页面时产生。所以在用户提交数据处进行输入检查的方案，其实并不是在真正发生攻击的地方做防御。

想要根治XSS问题，可以列出所有XSS可能发生的场景（在HTML标签中输出、在HTML属性中输出、在script标签中输出、在事件中输出、在CSS中输出、在地址中输出），再一一解决（HtmlEncode、JavaScriptEncode、URLEncode、校验（防治伪协议类的XSS）+URLEncode）。

具体防御：过滤、编码、限制（输入长度等）。

## 能用来干什么？

- **窃取网页浏览中的cookie值。**通常会用到JS脚本的document.cookie，Set-Cookie设置Http-Only保证无法从js获取cookies。
- **劫持流量实现恶意跳转。**也是会用到js脚本，window.location.href()会使访问的网站跳转到指定页面。早在2011年新浪就曾爆出过严重的xss漏洞，导致大量用户自动关注某个微博号并自动转发某条微博。、
- **配合csrf攻击完成恶意请求。**
- beef...

## 利用方法？绕过方法？

直接fuzz，alert弹窗当前ID。类似爆破webshell的手法。

## 子类型原理？

一类是反射型XSS，又称非持久型XSS；一类是储存型XSS，也就是持久型XSS。

反射型：攻击相对于访问者而言是一次性的，具体表现在我们把我们的恶意脚本通过url的方式传递给了服务器，而服务器则只是不加处理的把脚本“反射”回访问者的浏览器而使访问者的浏览器执行相应的脚本。

存储性：它与反射型XSS最大的不同就是服务器再接收到我们的恶意脚本时会将其做一些处理。例如储存到数据库中，然后当我们再次访问相同页面时，将恶意脚本从数据库中取出并返回给浏览器执行。这就意味着只要访问了这个页面的访客，都有可能会执行这段恶意脚本，因此储存型XSS的危害会更大。

## 子类型DOM型和反射型的区别？

DOM XSS漏洞是基于文档对象模型（Document Objeet Model，DOM树）的一种漏洞。

DOM XSS 是由于浏览器解析机制导致的漏洞，服务器不参与，而存储型与反射型都需要服务器响应参与。

举个例子：url#1，url#2，...滑动页面自动修改定位锚点，基于js ajax。

存储型XSS：你发送一次带XSS代码的请求，以后这个页面的返回包里都会有XSS代码；

反射型XSS：你发送一次带XSS代码的请求，只能在当前返回的数据包中发现XSS代码；

DOM型XSS：你发送一次带XSS代码的请求，在返回包里压根儿就找不到XSS代码的影子。